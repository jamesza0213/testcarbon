<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Carbon Dashboard</title>

<style>
body{
font-family: system-ui;
text-align:center;
margin:40px;
}
.big{
font-size:50px;
color:green;
}
</style>
</head>

<body>

<h1>üå± Carbon Reduction</h1>
<h3>‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
<div class="big" id="total">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

<script>

// ‚≠ê Google Sheet ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
const sheetID = "2PACX-1vSKUyS7phGfK5ZnkQgGVEnjobNNGaklsGgyLT3BjuF7E1Xk9av0cjH121GNOh6PTWjB5yXQIx4vVr8e";

const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSKUyS7phGfK5ZnkQgGVEnjobNNGaklsGgyLT3BjuF7E1Xk9av0cjH121GNOh6PTWjB5yXQIx4vVr8e/pub?output=csv" ;

fetch(url)
.then(res => res.text())
.then(text => {

try {

// ‚≠ê ‡∏ß‡∏¥‡∏ò‡∏µ parse ‡πÉ‡∏´‡∏°‡πà (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ substr ‡πÅ‡∏•‡πâ‡∏ß)
const json = JSON.parse(
text.match(/google\.visualization\.Query\.setResponse\((.*)\)/)[1]
);

const rows = json.table.rows;

let total = 0;

rows.forEach(row => {
const value = row.c[1]?.v;
if(value) total += Number(value);
});

document.getElementById("total").textContent =
total.toFixed(1) + " kg CO‚ÇÇ";

} catch(e) {
console.error(e);
document.getElementById("total").textContent = "‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
}

})
.catch(err => {
console.error(err);
document.getElementById("total").textContent = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheet ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ";
});

</script>

</body>
</html>
